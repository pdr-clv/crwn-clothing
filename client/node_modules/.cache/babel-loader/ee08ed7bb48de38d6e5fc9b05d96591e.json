{"ast":null,"code":"import { takeLatest, call, put, all, select } from 'redux-saga/effects'; //se importa select, para que se pueda hacer llamadas al selector del state-redux. Para obtener el user logeado y los cartsItems en el redux.\n\nimport UserActionTypes from '../user/user.types';\nimport CartActionTypes from './cart.types';\nimport { getUserCartRef } from '../../firebase/firebase.utils'; //getUserCartRef es para obtener los items que tiene guardado en el carrito el usuario, guardados en Firebase.\n\nimport { clearCart, setCartFromFirebase } from './cart.actions'; //se importan los selectors de current user y cartItems del state de redux.\n\nimport { selectCurrentUser } from '../user/user.selectors';\nimport { selectCartItems } from './cart.selectors';\nexport function* clearCartOnSignOut() {\n  yield put(clearCart());\n}\nexport function* checkCartFromFirebase() {\n  alert('se va a comprobar si hay items en el carrito'); //yield put(clearCart());\n}\nexport function* updateCartInFirebase({\n  payload: item\n}) {\n  const user = select(selectCurrentUser);\n  console.log(item);\n  console.log(user);\n  alert('se va a añadir este item a Firebase'); //yield put(clearCart());\n} //listener o disparador, que cada vez que el usuario haga sign_in, se compruebe que items hay en Firebase, y los cargue al state de redux\n\nexport function* onUserSignIn() {\n  yield takeLatest(UserActionTypes.SIGN_IN_SUCCESS, checkCartFromFirebase);\n} //listener para que cada vez que haya un cambio de items en el state de redux, actualice en Firebase la base de datos de los articulos guardados en firebase. \n\nexport function* onCartChange() {\n  yield takeLatest([CartActionTypes.REMOVE_ITEM, CartActionTypes.ADD_ITEM, CartActionTypes.CLEAR_ITEM_FROM_CART], updateCartInFirebase);\n}\nexport function* onSignOutSuccess() {\n  yield takeLatest(UserActionTypes.SIGN_OUT_SUCCESS, clearCartOnSignOut);\n}\nexport function* cartSagas() {\n  yield all([call(onSignOutSuccess), call(onCartChange), call(onUserSignIn)]);\n}","map":{"version":3,"sources":["/home/pdrclv/react/crwn-clothing/client/src/redux/cart/cart.sagas.js"],"names":["takeLatest","call","put","all","select","UserActionTypes","CartActionTypes","getUserCartRef","clearCart","setCartFromFirebase","selectCurrentUser","selectCartItems","clearCartOnSignOut","checkCartFromFirebase","alert","updateCartInFirebase","payload","item","user","console","log","onUserSignIn","SIGN_IN_SUCCESS","onCartChange","REMOVE_ITEM","ADD_ITEM","CLEAR_ITEM_FROM_CART","onSignOutSuccess","SIGN_OUT_SUCCESS","cartSagas"],"mappings":"AAAA,SAASA,UAAT,EAAqBC,IAArB,EAA2BC,GAA3B,EAAgCC,GAAhC,EAAqCC,MAArC,QAAkD,oBAAlD,C,CACA;;AAEA,OAAOC,eAAP,MAA4B,oBAA5B;AACA,OAAOC,eAAP,MAA4B,cAA5B;AAEA,SAASC,cAAT,QAA+B,+BAA/B,C,CACA;;AACA,SAASC,SAAT,EAAoBC,mBAApB,QAA+C,gBAA/C,C,CACA;;AACA,SAASC,iBAAT,QAAkC,wBAAlC;AACA,SAASC,eAAT,QAAgC,kBAAhC;AAEA,OAAO,UAAUC,kBAAV,GAA+B;AACpC,QAAMV,GAAG,CAACM,SAAS,EAAV,CAAT;AACD;AAED,OAAO,UAAUK,qBAAV,GAAkC;AACvCC,EAAAA,KAAK,CAAC,8CAAD,CAAL,CADuC,CAEvC;AACD;AAED,OAAO,UAAUC,oBAAV,CAA+B;AAACC,EAAAA,OAAO,EAACC;AAAT,CAA/B,EAA+C;AACpD,QAAMC,IAAI,GAAGd,MAAM,CAACM,iBAAD,CAAnB;AACAS,EAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ;AACAE,EAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;AACAJ,EAAAA,KAAK,CAAC,qCAAD,CAAL,CAJoD,CAKpD;AACD,C,CAED;;AACA,OAAO,UAAUO,YAAV,GAAyB;AAC9B,QAAMrB,UAAU,CAACK,eAAe,CAACiB,eAAjB,EAAiCT,qBAAjC,CAAhB;AACD,C,CACD;;AACA,OAAO,UAAUU,YAAV,GAAyB;AAC9B,QAAMvB,UAAU,CAAC,CACfM,eAAe,CAACkB,WADD,EAEflB,eAAe,CAACmB,QAFD,EAGfnB,eAAe,CAACoB,oBAHD,CAAD,EAKbX,oBALa,CAAhB;AAMD;AAGD,OAAO,UAAUY,gBAAV,GAA6B;AAClC,QAAM3B,UAAU,CAACK,eAAe,CAACuB,gBAAjB,EAAmChB,kBAAnC,CAAhB;AACD;AAED,OAAO,UAAUiB,SAAV,GAAsB;AAC3B,QAAM1B,GAAG,CAAC,CACRF,IAAI,CAAC0B,gBAAD,CADI,EAER1B,IAAI,CAACsB,YAAD,CAFI,EAGRtB,IAAI,CAACoB,YAAD,CAHI,CAAD,CAAT;AAKD","sourcesContent":["import { takeLatest, call, put, all, select} from 'redux-saga/effects';\n//se importa select, para que se pueda hacer llamadas al selector del state-redux. Para obtener el user logeado y los cartsItems en el redux.\n\nimport UserActionTypes from '../user/user.types';\nimport CartActionTypes from './cart.types';\n\nimport { getUserCartRef } from '../../firebase/firebase.utils';\n//getUserCartRef es para obtener los items que tiene guardado en el carrito el usuario, guardados en Firebase.\nimport { clearCart, setCartFromFirebase } from './cart.actions';\n//se importan los selectors de current user y cartItems del state de redux.\nimport { selectCurrentUser } from '../user/user.selectors';\nimport { selectCartItems } from './cart.selectors';\n\nexport function* clearCartOnSignOut() {\n  yield put(clearCart());\n}\n\nexport function* checkCartFromFirebase() {\n  alert('se va a comprobar si hay items en el carrito');\n  //yield put(clearCart());\n}\n\nexport function* updateCartInFirebase({payload:item}) {\n  const user = select(selectCurrentUser);\n  console.log(item);\n  console.log(user);\n  alert('se va a añadir este item a Firebase');\n  //yield put(clearCart());\n}\n\n//listener o disparador, que cada vez que el usuario haga sign_in, se compruebe que items hay en Firebase, y los cargue al state de redux\nexport function* onUserSignIn() {\n  yield takeLatest(UserActionTypes.SIGN_IN_SUCCESS,checkCartFromFirebase);\n}\n//listener para que cada vez que haya un cambio de items en el state de redux, actualice en Firebase la base de datos de los articulos guardados en firebase. \nexport function* onCartChange() {\n  yield takeLatest([\n    CartActionTypes.REMOVE_ITEM,\n    CartActionTypes.ADD_ITEM,\n    CartActionTypes.CLEAR_ITEM_FROM_CART\n  ]\n    ,updateCartInFirebase);\n}\n\n\nexport function* onSignOutSuccess() {\n  yield takeLatest(UserActionTypes.SIGN_OUT_SUCCESS, clearCartOnSignOut )\n}\n\nexport function* cartSagas() {\n  yield all([\n    call(onSignOutSuccess),\n    call(onCartChange),\n    call(onUserSignIn)\n  ]);\n}"]},"metadata":{},"sourceType":"module"}